# 智能大脑架构设计 (Intelligent Brain Architecture Design)
日期: 2026-01-23 (V2)
状态: 已批准

## 1. 概述
将 Agent 重构为由 LLM 驱动的中心化大脑架构。核心目标是实现**类人销售**体验：灵活的预算处理、智能的替代品联想、以及幽默风趣的对话风格。

## 2. 核心原则 (Core Principles)
1.  **预算灵活 (Smart Upsell)**: 预算不是铁律。如果高价产品 ($25) 比预算 ($20) 更匹配且物有所值，Agent 必须尝试推荐并解释理由。
2.  **知识增强 (External Knowledge)**: 当用户请求库存里没有的特定品种（如"Purple Haze"）时，Agent 不应直接说没有，而应利用 LLM 知识找到库存中**效果或基因相似**的替代品（如"Sour Diesel"）。
3.  **风格 (Persona)**: "Fried Rice" —— 专业但带有幽默感，不罗嗦也不冷漠，像个懂行的老朋友。

## 3. 架构组件

### A. The Brain (Agent Core)
- **模型**: GPT-4o (推荐) 或 GPT-4o-mini。
- **职责**: 对话管理、销售策略决策、幽默感生成。

### B. 超级工具: `smart_search` (Smart Search Tool)
这是一个增强型工具，内部包含智能逻辑：

- **输入**: `query` (用户原话), `budget_target` (可选), `intent_keywords`.
- **数据源**: `NYE2.1` 数据库 (CSV 格式)。注意：数据目前为原始状态 (Raw Data)，可能需要进行预清洗以提高搜索准确性。
- **内部流程**:
  1.  **精确搜索**: 在 CSV 中查找名称/标签直接匹配的产品。
  2.  **判断**: 有结果吗？
      - *有* -> 返回结果。
      - *没有* -> **联想阶段 (Association)**:
        - 调用内部 LLM (轻量级) 分析 `query` (e.g., "Purple Haze" -> Sativa, Creative, Specific Terpenes)。
        - 转换搜索条件：搜 `type=Sativa`, `effect=Creative`。
        - 再次从 `NYE2.1` 数据库中搜索。
  3.  **返回**: 推荐列表，并标记是否为"替代推荐" (Alternative)。

### C. 辅助工具: `get_product_details`
- 查看详情，用于回答刁钻问题。

## 4. "销售圣经" (System Prompt 核心指令)
- **Voice**: "Add a distinct touch of humor. Don't be dry."
- **Strategy**: "If user asks for something we don't have, find the closest cousin and sell the experience. Don't simply say 'out of stock'."
- **Budget**: "Respect budget, but challenge it if quality justifies the price."

## 5. 迁移路线
1.  **Implement `smart_search`**: 这是最大的技术难点，需要在 Tool 内部集成 LLM 逻辑。
2.  **Setup Agent Logic**: 配置 System Prompt 落地。
3.  **Cleanup**: 删除旧的 Router/Matcher 代码。

## 6. 成功标准 (验收场景)
- **Upsell**: 用户要 $20，Agent 成功推荐 $25 并说服用户。
- **Fallback**: 用户要 "Blue Dream" (没货)，Agent 推荐 "类似的 Sativa 混种"。
- **Chat**: 用户会被 Agent 的一句俏皮话逗乐，而不是面对冷冰冰的列表。
