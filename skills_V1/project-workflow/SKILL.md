---
name: project-workflow
description: 一键执行完整项目规划流程。自动生成、审核、修复项目计划书和任务清单，直到全部通过。
allowed-tools: Read, Glob, Grep, Write, Edit
---

# 项目规划编排器

## 概述

自动执行完整的项目规划流程，包含以下5个阶段：

```
阶段1: 生成项目计划书
阶段2: 审核项目计划书 → 未通过则修复（最多3次）
阶段3: 生成任务清单
阶段4: 审核任务清单 → 未通过则修复（最多3次）
阶段5: 输出完成总结
```

## 执行流程

### 阶段1：生成项目计划书

1. 调用 `/project-plan-generator`
2. 等待生成 PROJECT_PLAN_v1.md
3. 确认文件存在后进入阶段2

### 阶段2：审核项目计划书（循环）

```
循环开始 (最多3次):
  1. 调用 /project-plan-reviewer
  2. 解析审核报告中的评分
  3. 如果 ≥ 90分 → 进入阶段3
  4. 如果 < 90分 且 循环次数 < 3:
     - 调用 /project-plan-fixer
     - 继续循环
  5. 如果循环3次仍未通过:
     - 输出警告
     - 询问用户是否继续
循环结束
```

### 阶段3：生成任务清单

1. 确认 PROJECT_PLAN 已通过审核（检查 `PROJECT_PLAN_REVIEW.md` 评分≥90）
2. 调用 `/todolist-generator`
3. 等待生成 TODOLIST_v1.md
4. 确认文件存在后进入阶段4

### 阶段4：审核任务清单（循环）

```
循环开始 (最多3次):
  1. 调用 /todolist-reviewer
  2. 解析审核报告中的评分
  3. 如果 ≥ 90分 → 进入阶段5
  4. 如果 < 90分 且 循环次数 < 3:
     - 调用 /todolist-fixer
     - 继续循环
  5. 如果循环3次仍未通过:
     - 输出警告
     - 询问用户是否继续
循环结束
```

### 阶段5：完成总结

输出以下信息：
- 生成的文件列表
- 各阶段审核结果
- 下一步建议

## 评分解析规则

从审核报告中提取评分：
- 搜索"总分"或"综合评分"
- 提取数值（格式：XX/100 或 XX分）
- 90分及以上视为通过

## 状态追踪

每个阶段结束后输出进度：

```
[阶段1/5] ✅ PROJECT_PLAN_v1.md 生成完成
[阶段2/5] ⏳ 审核中... (第1次)
[阶段2/5] ❌ 评分: 82/100，需要修复
[阶段2/5] ⏳ 修复中...
[阶段2/5] ⏳ 审核中... (第2次)
[阶段2/5] ✅ 评分: 92/100，通过
[阶段3/5] ✅ TODOLIST_v1.md 生成完成
...
```

## 中断处理

如果任何阶段失败：
1. 输出当前进度和失败原因
2. 提示用户可手动执行后续步骤
3. 不自动继续

## 强制规则

1. **按顺序执行**：不跳过任何阶段
2. **评分标准**：必须使用 SPEC.md 中的90分标准
3. **修复上限**：每个审核循环最多修复3次
4. **文件检查**：每个阶段开始前检查前置文件存在
5. **完整输出**：每个阶段都输出状态信息

## 输出摘要模板

```
# 项目规划完成报告

## 执行结果

| 阶段 | 状态 | 详情 |
|------|------|------|
| 项目计划生成 | ✅ | PROJECT_PLAN_v{N}.md |
| 项目计划审核 | ✅ | {评分}/100 (第{M}次通过) |
| 任务清单生成 | ✅ | TODOLIST_v1.md |
| 任务清单审核 | ✅ | {评分}/100 (第{M}次通过) |

## 生成文件

- PROJECT_PLAN_v{N}.md
- PROJECT_PLAN_REVIEW.md
- TODOLIST_v{M}.md
- TODOLIST_REVIEW.md

## 下一步

按 TODOLIST_v{M}.md 中的顺序执行开发任务。
```
