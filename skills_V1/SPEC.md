# 项目规划工作流 - 共享规范

> 本文件定义所有 Skill 的强制规则
> 生成 Skill 执行规则，审核 Skill 检查规则

---

## 一、PROJECT_PLAN 规则

### 1.1 结构规则

| ID | 规则 | 检查方法 |
|----|------|---------|
| P-S1 | MVP期维度数 = 9 | 数目录中的维度标题数量 |
| P-S2 | 扩展期维度数 = 11 | 数目录中的维度标题数量 |
| P-S3 | 成熟期维度数 = 13 | 数目录中的维度标题数量 |
| P-S4 | 维度9标题 = "测试与验证策略" | 检查 `## 9.` 开头的标题 |
| P-S5 | 必须有"初步可行性评估"章节 | 搜索该章节标题 |
| P-S6 | 必须有"生成信息"章节 | 搜索该章节标题 |

### 1.2 维度定义

**9个基础维度（MVP期必需）**：

| 维度 | 标题 | 必需内容 |
|------|------|---------|
| 1 | 项目概述 | 产品愿景、目标用户、核心价值、项目类型 |
| 2 | 需求分析 | 功能需求(P0/P1)、非功能需求、业务规则、约束条件 |
| 3 | 系统架构 | 架构模式、架构图(含数据流)、分层说明、SOLID符合度 |
| 4 | 技术栈选型 | 语言、框架、数据库、测试工具（每项只写一个） |
| 5 | 核心模块设计 | 每模块：职责、位置、接口、实现思路、扩展点 |
| 6 | API接口文档 | 端点列表、请求/响应格式、认证方式 |
| 7 | 数据模型设计 | 表/结构定义、字段说明、数据流动 |
| 8 | 项目结构 | 目录树、目录说明 |
| 9 | 测试与验证策略 | 测试框架、测试类型、验收标准、测试命令 |

**扩展期增加（维度10-11）**：

| 维度 | 标题 |
|------|------|
| 10 | 部署安装 |
| 11 | 使用指南 |

**成熟期增加（维度12-13）**：

| 维度 | 标题 |
|------|------|
| 12 | 成本估算 |
| 13 | 常见问题 |

### 1.3 内容规则

| ID | 规则 | 检查方法 |
|----|------|---------|
| P-C1 | 技术选型只写一个，禁止"A / B"写法 | 搜索维度4中的"/"符号 |
| P-C2 | 替代方案放在"备注"列 | 检查表格结构 |
| P-C3 | 核心模块 ≥ 3 个 | 数维度5中的模块数 |
| P-C4 | 每个模块有扩展点标注 | 检查"扩展点"关键词 |
| P-C5 | TODO标记 ≤ 10 个 | 搜索 `<!-- TODO` |
| P-C6 | 占位符 ≤ 5% | 搜索 `{...}` 占位符 |

### 1.4 可行性评估规则

| ID | 规则 | 检查方法 |
|----|------|---------|
| P-E1 | 必须有"需求完整度"评分 | 搜索该字段 |
| P-E2 | 必须有"技术可行性"评分 | 搜索该字段 |
| P-E3 | 必须有"资源充足度"评分 | 搜索该字段 |
| P-E4 | 必须有"综合评分" | 搜索该字段 |

### 1.5 阶段判断规则

| 阶段 | 条件 | 维度数 |
|------|------|-------|
| MVP验证期 | 代码 < 500行 或 模块 ≤ 2 或 关键词"新建/创建" | 9 |
| 功能扩展期 | 代码 < 2000行 或 有数据库但无部署配置 | 11 |
| 系统成熟期 | 代码 ≥ 2000行 或 关键词"上线/生产" | 13 |

---

## 二、TODOLIST 规则

### 2.1 结构规则

| ID | 规则 | 检查方法 |
|----|------|---------|
| T-S1 | 必须有"进度追踪"章节 | 搜索章节标题 |
| T-S2 | 必须有"任务依赖关系"章节 | 搜索章节标题 |
| T-S3 | 必须有"任务详情"章节 | 搜索章节标题 |
| T-S4 | 必须有"首次执行指令"章节 | 搜索章节标题 |
| T-S5 | 必须有"工具说明"章节 | 搜索章节标题 |
| T-S6 | 必须有"注意事项"章节 | 搜索章节标题 |

### 2.2 Task 规则

| ID | 规则 | 检查方法 |
|----|------|---------|
| T-T1 | 每个 Task 必须有"功能要求"部分 | 搜索该标题，检查内容 ≥ 3 条 |
| T-T2 | 每个 Task 必须有"实现位置"部分 | 搜索该标题，检查有文件路径 |
| T-T3 | 每个 Task 必须有"代码审核"部分 | 搜索该标题，检查有具体命令 |
| T-T4 | 每个 Task 必须有"测试验证"部分 | 搜索该标题，检查有测试用例 |
| T-T5 | 每个 Task 必须有"验收标准"部分 | 搜索该标题，检查有标准列表 |
| T-T6 | 每个 Task 必须有"完成后必须执行"部分 | 搜索该标题 |
| T-T7 | 每个 Task 必须有"优先级"标注 | 检查 P0/P1/P2 标记 |
| T-T8 | 每个 Task 必须有"依赖关系"标注 | 检查依赖说明 |

### 2.3 初始状态规则

| ID | 规则 | 检查方法 |
|----|------|---------|
| T-I1 | 新生成的进度 = 0% | 检查进度追踪章节 |
| T-I2 | 所有 Task 状态 = "未开始" | 检查每个 Task 的状态字段 |
| T-I3 | 进度条显示 0% | 检查图示进度 |
| T-I4 | 所有 checkbox 未勾选 | 检查 `[ ]` 而非 `[x]` |

### 2.4 依赖规则

| ID | 规则 | 检查方法 |
|----|------|---------|
| T-D1 | 无依赖的 Task 排在最前 | 检查 Task 顺序 |
| T-D2 | 有依赖的 Task 在依赖项之后 | 验证拓扑排序 |
| T-D3 | 不允许循环依赖 | 检查依赖图 |
| T-D4 | 依赖编号必须有效 | 检查引用的 Task 是否存在 |

### 2.5 数量规则

| 项目规模 | 模块数 | Task 数范围 |
|---------|-------|------------|
| 小项目 | ≤ 5 | 5-8 |
| 中项目 | 6-15 | 8-20 |
| 大项目 | ≥ 16 | 15-30 |

---

## 三、审核评分规则

### 3.1 PROJECT_PLAN 审核维度

| 维度 | 权重 | 检查重点 |
|------|------|---------|
| 需求对齐度 | 15分 | P0功能全覆盖、非功能需求有方案 |
| 架构设计质量 | 20分 | SOLID原则、数据流清晰、扩展点充足 |
| 技术方案完整性 | 15分 | 无模糊表述、占位符 ≤ 5% |
| 命名一致性 | 10分 | 技术栈/模块/数据模型命名前后一致 |
| 可执行性 | 20分 | 实现步骤具体（3-5步）、模块协作清晰 |
| 测试验证完备性 | 10分 | 测试框架明确、有验收标准 |
| 文档质量 | 10分 | 维度完整、TODO ≤ 10、格式规范 |

### 3.2 TODOLIST 审核维度

| 维度 | 权重 | 检查重点 |
|------|------|---------|
| 三方对齐度 | 20分 | 需求→计划→Todolist 全覆盖 |
| Task依赖正确性 | 20分 | 依赖准确、排序正确、无循环 |
| Task粒度合理性 | 15分 | 单Task 4-8小时工作量 |
| Task完整性 | 15分 | 7个部分都有实质内容 |
| 质量保障可行性 | 15分 | 工具匹配、测试要求合理 |
| 可执行性 | 15分 | AI能按顺序无脑执行 |

### 3.3 评分标准

| 评分 | 结果 | 建议 |
|------|------|------|
| ≥ 90 | ✅ 通过 | 进入下一阶段 |
| 80-89 | ⚠️ 接近通过 | 修复 P0 问题后重审 |
| 70-79 | ❌ 未通过 | 修复 P0+P1 问题 |
| < 70 | ❌ 严重不通过 | 建议重新生成 |

### 3.4 问题分级

| 级别 | 定义 | 示例 |
|------|------|------|
| P0 | 必须修复，阻塞下一步 | 缺少必需维度、结构错误 |
| P1 | 建议修复，影响质量 | TODO过多、部分内容不完整 |
| P2 | 可选优化 | 格式优化、补充说明 |

---

## 四、规则检查清单

### 4.1 PROJECT_PLAN 生成后自检

```
□ P-S1/S2/S3: 维度数量正确？
□ P-S4: 维度9标题是"测试与验证策略"？
□ P-S5: 有"初步可行性评估"章节？
□ P-C1: 技术选型无"A / B"写法？
□ P-C3: 核心模块 ≥ 3 个？
□ P-C5: TODO标记 ≤ 10 个？

任何一项未通过 → 修正后再输出
```

### 4.2 TODOLIST 生成后自检

```
□ T-S1~S6: 6个必需章节都存在？
□ T-T1~T6: 每个Task的6个部分都有内容？
□ T-I1~I4: 初始状态正确（进度0%、状态未开始）？
□ T-D1~D4: 依赖关系正确？

任何一项未通过 → 修正后再输出
```

### 4.3 审核时必须检查

**PROJECT_PLAN 审核**：
```
第一步：结构检查（P-S1~S6）→ 任何一项失败 = P0
第二步：内容检查（P-C1~C6）→ 失败项 = P0/P1
第三步：评估检查（P-E1~E4）→ 任何一项失败 = P0
第四步：7维度评分
```

**TODOLIST 审核**：
```
第一步：结构检查（T-S1~S6）→ 任何一项失败 = P0
第二步：Task检查（T-T1~T8）→ 逐Task验证，失败 = P0
第三步：状态检查（T-I1~I4）→ 任何一项失败 = P0
第四步：依赖检查（T-D1~D4）→ 任何一项失败 = P0
第五步：6维度评分
```
