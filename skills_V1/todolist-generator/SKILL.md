---
name: todolist-generator
description: 根据审核通过的项目计划书生成开发任务清单（TODOLIST.md）。自动分析模块依赖并拓扑排序。
allowed-tools: Read, Grep, Glob, Write
---

# 生成开发任务清单

## 执行步骤

1. 读取 PROJECT_PLAN_vN.md（需已通过审核）
   - 检查 `PROJECT_PLAN_REVIEW.md` 确认评分≥90
2. 从维度5提取所有核心模块
3. 分析模块依赖关系，构建依赖图
4. 拓扑排序，确定 Task 顺序
5. 为每个模块生成 Task（包含6个必需部分）
6. 生成6个必需章节
7. 执行输出自检
8. 输出 TODOLIST_v1.md

## 依赖分析

从以下位置提取依赖关系：
- 维度5：模块的"依赖"说明
- 维度3：数据流图
- 维度6：API调用关系

**拓扑排序规则**：
- 无依赖的模块排最前
- 有依赖的模块在依赖项之后
- 检测到循环依赖 → 报错停止

## Task 必需部分

每个 Task **必须**包含以下6部分（SPEC.md T-T1~T6）：

### 1. 功能要求（≥3条）
```markdown
**功能要求**:
1. {具体功能点1}
2. {具体功能点2}
3. {具体功能点3}
```

### 2. 实现位置
```markdown
**实现位置**:
- 文件: `src/{path}/{module}.py`
- 测试: `tests/test_{module}.py`
```

### 3. 代码审核（有具体命令）
```markdown
**代码审核**:
```bash
pylint {模块路径} --rcfile=.pylintrc
bandit -r {模块路径} -f txt
```
```

### 4. 测试验证（有用例列表）
```markdown
**测试验证**:
```bash
pytest {测试文件} -v --cov={模块路径}
```

测试用例:
- test_{功能1}
- test_{功能2}
- test_{边界情况}
- test_{异常情况}
```

### 5. 验收标准
```markdown
**验收标准**:
- [ ] {标准1}
- [ ] {标准2}
```

### 6. 完成后必须执行
```markdown
**完成后必须执行**:
1. 确认代码审核通过
2. 确认测试通过
3. 更新 TODOLIST 进度
4. 检查下一个 Task 的前置条件
```

## 每个 Task 生成后检查

生成每个 Task 后，立即验证：

```
□ 有"功能要求"且 ≥ 3 条？
□ 有"实现位置"且有文件路径？
□ 有"代码审核"且有具体命令？
□ 有"测试验证"且有用例列表？
□ 有"验收标准"？
□ 有"完成后必须执行"？
```

**任何一项缺失 → 补充后再继续下一个 Task**

## 必需章节

TODOLIST 必须包含6个章节（SPEC.md T-S1~S6）：

1. **进度追踪** - 显示总体进度和每个Task状态
2. **任务依赖关系** - ASCII图展示依赖
3. **任务详情** - 所有Task的完整内容
4. **首次执行指令** - 创建配置文件的指令
5. **工具说明** - 测试和审核工具说明
6. **注意事项** - 执行顺序和完成标准提醒

## 初始状态规则

新生成的 TODOLIST 必须满足（SPEC.md T-I1~I4）：

1. 进度 = 0%（不是100%）
2. 所有 Task 状态 = "未开始"（不是"已完成"）
3. 进度条显示 0%
4. 所有 checkbox 未勾选 `[ ]`（不是 `[x]`）

## 输出自检

生成后，对照 SPEC.md 4.2 检查：

```
□ 6个必需章节都存在？
□ 每个Task的6个部分都有内容？
□ 进度 = 0%？
□ 所有Task状态 = "未开始"？
□ 依赖关系正确（无循环）？
```

**任何一项未通过 → 修正后再输出**

## 输出模板

见 [templates/output-template.md](./templates/output-template.md)
