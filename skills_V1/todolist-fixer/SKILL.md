---
name: todolist-fixer
description: 根据审核报告自动修复 TODOLIST.md 中的问题，生成新版本。
allowed-tools: Read, Grep, Glob, Edit, Write
---

# 修复开发任务清单

## 执行步骤

1. 读取 TODOLIST.md（或 TODOLIST_vN.md）
2. 备份原文件为 TODOLIST.md.bak
3. 读取审核报告 `TODOLIST_REVIEW.md`
4. 提取 P0 和 P1 问题列表
5. 按优先级修复：P0 → P1
6. 执行输出自检（SPEC.md 4.2）
7. 生成修复后的 TODOLIST_v{N+1}.md
8. 输出修复记录

## 修复规则

1. **只修复审核报告中列出的问题**
2. **不添加报告未提及的修改**
3. **P0 + P1 自动修复，P2 询问用户**

## 常见问题修复方法

### T-S1~S6: 缺少必需章节

```
问题：缺少"进度追踪"章节
修复：根据 Task 列表生成进度追踪章节

### 进度追踪

**总体进度**: 0/{N} (0%)

- [ ] Task 1: {ModuleName}
- [ ] Task 2: {ModuleName}
...

**图示进度**:
░░░░░░░░░░░░░░░░░░░░ 0%
```

### T-T1~T6: Task 缺少必需部分

```
问题：Task 3 缺少"功能要求"部分
修复：
1. 从 PROJECT_PLAN.md 维度5 提取该模块的功能描述
2. 转换为功能要求列表（≥3条）
3. 插入到 Task 中
```

### T-I1~I4: 初始状态错误

```
问题：进度显示 100% 而非 0%
修复：
1. 将"总体进度: X/N (Y%)"改为"总体进度: 0/N (0%)"
2. 将所有 [x] 改为 [ ]
3. 将所有"状态: 已完成"改为"状态: 未开始"
4. 将进度条改为 ░░░░░░░░░░░░░░░░░░░░ 0%
```

### T-D1~D4: 依赖关系错误

```
问题：有循环依赖 Task2 → Task3 → Task2
修复：
1. 分析实际依赖关系
2. 打破循环：移除不必要的依赖
3. 重新排序 Task
```

## 修复流程

```
1. 解析审核报告 → 提取问题列表
2. 对每个 P0 问题：
   - 定位修改位置
   - 应用修复方案
   - 记录修复状态
3. 对每个 P1 问题：
   - 同上
4. 执行自检（SPEC.md 4.2）
5. 如有未通过项 → 继续修复
6. 输出修复后的文件
```

## 定位失败处理

如果无法精确定位修改位置：
1. 跳过该问题
2. 在修复记录中标记"⚠️ 需手动修复"
3. 继续处理下一个问题

## 输出自检

修复后必须对照 SPEC.md 4.2 检查：

```
□ 6个必需章节都存在？
□ 每个Task的6个部分都有内容？
□ 进度 = 0%？
□ 所有Task状态 = "未开始"？
□ 依赖关系正确（无循环）？
```

## 版本管理

- 检测当前目录是否存在 TODOLIST_v*.md
- 找到最大版本号 N，生成 v{N+1}
- 如果没有版本文件，从 v1 开始
- 原文件备份为 .bak

## 输出格式

**修复后文件**: TODOLIST_v{N+1}.md（保留原文件备份）

**修复记录**: 见 [templates/fix-record.md](./templates/fix-record.md)
